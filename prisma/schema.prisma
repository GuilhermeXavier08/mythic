// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// --- User Roles ---
enum Role {
  USER
  ADMIN
}

// --- Game Status ---
enum GameStatus {
  PENDING   // Pendente de aprovação
  APPROVED  // Aprovado e visível na loja
  REJECTED  // Rejeitado pelo admin
}

// --- Friend Request Status ---
enum RequestStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model User {
  id        String     @id @default(cuid())
  email     String     @unique
  name      String?
  username  String     @unique
  friendCode Int       @unique
  bio              String?
  password  String
  createdAt DateTime   @default(now())
  
  role      Role       @default(USER)
  
  // Game related relations
  purchases Purchase[]
  submittedGames Game[]

  // Friend related relations
  sentRequests     FriendshipRequest[] @relation("SentRequests")
  receivedRequests FriendshipRequest[] @relation("ReceivedRequests")
  friendships1     Friendship[]        @relation("User1Friendships")
  friendships2     Friendship[]        @relation("User2Friendships")
}

model Game {
  id          String     @id @default(cuid())
  title       String
  description String
  price       Float
  imageUrl    String
  gameUrl     String     @default("")
  status      GameStatus @default(PENDING)
  
  developerId String
  developer   User     @relation(fields: [developerId], references: [id])

  purchases   Purchase[]
  
  @@unique([developerId, title])
}

model Purchase {
  id          String   @id @default(cuid())
  userId      String
  gameId      String
  purchasedAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
  game Game @relation(fields: [gameId], references: [id])

  @@unique([userId, gameId])
}

model FriendshipRequest {
  id         String        @id @default(cuid())
  senderId   String
  sender     User          @relation("SentRequests", fields: [senderId], references: [id])
  receiverId String
  receiver   User          @relation("ReceivedRequests", fields: [receiverId], references: [id])
  status     RequestStatus @default(PENDING)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  @@unique([senderId, receiverId])
}

model Friendship {
  id        String   @id @default(cuid())
  userId1   String
  user1     User     @relation("User1Friendships", fields: [userId1], references: [id])
  userId2   String
  user2     User     @relation("User2Friendships", fields: [userId2], references: [id])
  createdAt DateTime @default(now())

  @@unique([userId1, userId2])
  @@index([userId1])
  @@index([userId2])
}